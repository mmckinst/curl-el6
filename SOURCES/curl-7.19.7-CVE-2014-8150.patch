From e2e894d9f76966710838550c28dd4da974034d8d Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Thu, 25 Dec 2014 23:55:03 +0100
Subject: [PATCH] url-parsing: reject CRLFs within URLs

Bug: http://curl.haxx.se/docs/adv_20150108B.html
Reported-by: Andrey Labunets

Upstream-commit: 178bd7db34f77e020fb8562890c5625ccbd67093
Signed-off-by: Kamil Dudka <kdudka@redhat.com>
---
 lib/url.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/lib/url.c b/lib/url.c
index a378af3..f318931 100644
--- a/lib/url.c
+++ b/lib/url.c
@@ -3284,6 +3284,13 @@ static CURLcode ParseURLAndFillConnection(struct SessionHandle *data,
   int rc;
   bool fix_slash = FALSE;
 
+  /* We might pass the entire URL into the request so we need to make sure
+   * there are no bad characters in there.*/
+  if(strpbrk(data->change.url, "\r\n")) {
+    failf(data, "Illegal characters found in URL");
+    return CURLE_URL_MALFORMAT;
+  }
+
   /*************************************************************
    * Parse the URL.
    *
-- 
2.1.0

